<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Prayash | Special Days â€” Interactive</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
<style>
    :root {
        --primary: #6C63FF;
        --bg: #F0F2F5;
        --card-bg: #FFFFFF;
        --text-main: #2D3436;
        --text-light: #636E72;
        --control-bg: #ffffff;
    }
    *{box-sizing:border-box}
    body{font-family:'Outfit',sans-serif;background:var(--bg);color:var(--text-main);padding:20px}
    header{text-align:center;margin-bottom:24px}
    h1{margin:0;font-weight:600}
    p{color:var(--text-light);margin:6px 0 0}
    .controls{
        display:flex;align-items:center;justify-content:center;gap:12px;flex-wrap:wrap;margin-bottom:16px;
        position:relative;
    }

    /* Rounded, borderless selects like sort buttons */
    select, .search {
        padding:10px 14px;
        border-radius:999px;
        border: none; /* removed border */
        background: var(--control-bg);
        box-shadow: 0 6px 18px rgba(15,15,15,0.05);
        font-family: inherit;
        cursor: pointer;
        outline: none;
    }

    /* keep hover micro lift like buttons */
    select:hover, .search:hover { transform: translateY(-2px); transition: transform .12s ease; }

    /* Sort buttons styling (round, no border) */
    .btn {
        padding: 10px 14px;
        border-radius: 999px;
        border: none; /* removed border */
        background: var(--control-bg);
        box-shadow: 0 6px 18px rgba(15,15,15,0.05);
        cursor:pointer;
        font-weight:600;
        color:var(--text-main);
    }
    .btn:hover { transform: translateY(-2px); }
    .btn.active-sort {
        background: var(--primary);
        color: #fff;
        box-shadow: 0 8px 26px rgba(108,99,255,0.14);
    }

    .grid-container{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:25px;max-width:1200px;margin:14px auto}
    .card{background:var(--card-bg);border-radius:18px;padding:20px;text-align:center;box-shadow:0 10px 25px rgba(0,0,0,0.06);position:relative;overflow:visible;transition:transform .18s}
    .card:hover{transform:translateY(-6px)}
    .card.Male{border-bottom:4px solid #2196F3}
    .card.Female{border-bottom:4px solid #E91E63}
    .avatar{width:100px;height:100px;border-radius:50%;object-fit:cover;margin-bottom:12px;border:3px solid white;box-shadow:0 6px 16px rgba(0,0,0,0.08);display:inline-block}
    .name{font-size:1.15rem;font-weight:600;margin-bottom:6px}
    .meta{color:var(--text-light);font-size:0.92rem;margin-bottom:8px}
    .tag{font-size:0.75rem;padding:4px 10px;border-radius:12px;background:#eee;color:#555;display:inline-block;margin-bottom:10px;margin-right:6px}
    .tag.Friend{background:#e8f5e9;color:#2e7d32}
    .tag.Spouse{background:#fff3e0;color:#ef6c00}
    .tag.Child{background:#f3e5f5;color:#7b1fa2}
    .tag.Anniversary{background:#ffece6;color:#d32f2f}
    .date-info{display:flex;justify-content:center;gap:8px;color:var(--primary);font-weight:600;margin-top:6px}
    .countdown{font-size:0.9rem;color:var(--text-light);margin-top:8px}
    .spouse-line{margin-top:8px;color:var(--text-light);font-size:0.95rem}
    .spouse-link{color:var(--primary);cursor:pointer;text-decoration:underline;background:transparent;border:none;padding:0;font-weight:600}
    .parents-block{margin-top:10px;font-size:0.88rem;color:var(--text-light);background:#fafafa;padding:8px;border-radius:8px;border:1px solid #f0f0f0}
    .parents-block .parent-link{color:var(--primary);cursor:pointer;text-decoration:underline;font-weight:600;margin-left:8px}
    .tree-wrap{max-height:0;overflow:hidden;transition:max-height .36s cubic-bezier(.2,.9,.3,1);margin-top:12px}
    .tree{padding-left:12px;position:relative}
    .tree::before{content:"";position:absolute;left:8px;top:0;bottom:0;width:2px;background:#eee;border-radius:2px}
    .node{background:#fff;border-radius:12px;padding:10px 12px;display:flex;gap:10px;align-items:center;box-shadow:0 8px 20px rgba(0,0,0,0.04);margin-bottom:12px;position:relative}
    .node:before{content:"";position:absolute;left:-18px;top:16px;width:18px;height:2px;background:#eee}
    .n-avatar{width:48px;height:48px;border-radius:50%;object-fit:cover}
    .n-title{font-weight:600}
    .n-sub{color:var(--text-light);font-size:0.86rem;margin-top:4px}
    .children{padding-left:24px;margin-top:-6px}
    .badge{font-size:0.75rem;padding:4px 8px;border-radius:999px;background:#f3f3ff;color:var(--primary);display:inline-block;margin-left:8px}
    @media (max-width:560px){.avatar{width:80px;height:80px}.n-avatar{width:40px;height:40px}}

    /* Upcoming event section */
    .upcoming {
        max-width:1200px;
        margin: 6px auto 12px;
        background: linear-gradient(90deg,#fff,#fbfbff);
        border-radius:12px;
        padding:18px;
        display:flex;
        align-items:center;
        justify-content:center;
        gap:12px;
        box-shadow: 0 8px 30px rgba(60,60,120,0.06);
        position: relative; /* needed for absolute confetti */
        text-align: center;  /* center text inside */
    }
    .upcoming .msg {
        font-weight:600;
        font-size:1rem;
        color:var(--text-main);
        text-align: center;
    }
    .upcoming .date {
        color:var(--text-light);
        font-weight:600;
        text-align: center;
    }
    /* confetti container */
    .confetti {
        position: absolute;
        top: -18px;               /* above the box's top edge â€” tweak if needed */
        left: 50%;
        transform: translateX(-50%);
        width: 220px;             /* widen the confetti spread */
        height: 48px;             /* space for falling pieces */
        pointer-events: none;     /* so it doesn't block clicks */
        overflow: visible;
    }
    .confetti span {
        position:absolute;
        top: -8px;
        width:10px;
        height:10px;
        border-radius:2px;
        opacity:0.95;
        transform: translateY(0) rotateZ(0);
        animation-name: confettiFall;
        animation-iteration-count: infinite;     /* run continuously */
        animation-timing-function: cubic-bezier(.2,.9,.3,1);
        animation-fill-mode: both; 
    }
    @keyframes confettiFall {
        0% { transform: translateY(-8px) rotateZ(0) scale(1); opacity:1 }
        80% { opacity:1 }
        100% { transform: translateY(110px) rotateZ(360deg) scale(0.95); opacity:0 }
    }
</style>
</head>
<body>

<header>
    <h1>Prayash | Special Days</h1>
    <p>Click spouse/parent names to jump & expand their card</p>
</header>

<div class="controls">
    <input id="searchInput" class="search" placeholder="Search name..." oninput="handleSearch()" autocomplete="off" aria-label="Search">

    <select id="genderFilter" onchange="renderCards()" aria-label="Filter by gender">
        <option value="All">All</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
    </select>

    <select id="categoryFilter" onchange="renderCards()" aria-label="Filter by category">
        <option value="All">All Categories</option>
        <option value="Friend">Friends</option>
        <option value="Spouse">Spouses</option>
        <option value="Child">Children</option>
        <option value="Anniversary">Anniversaries</option>
    </select>

    <button onclick="setSort('alpha')" id="btnAlpha" class="btn">Sort A-Z</button>
    <button onclick="setSort('date')" id="btnDate" class="btn">Sort by Date</button>
</div>

<!-- Upcoming event with confetti -->
<div id="upcomingSection" class="upcoming" aria-live="polite" style="display:none">
    <div>
        <div class="msg" id="upcomingMsg">Wish X on Y Date</div>
        <div class="date" id="upcomingDate">Date</div>
    </div>
    <div class="confetti" id="confetti"></div>
</div>

<div class="grid-container" id="cardGrid" aria-live="polite"></div>

<script>
/* ====================
   Data (start)
   ==================== */
const people = [
    { name: "Kamanasish Bhattacharjee", type: ["Friend"], gender: "Male", date: "11-08", photo: "photos/Kamanasish_Bhattacharjee.jpeg", spouseName: "Debosmita Bhattacharjee" },
    { name: "Debosmita Bhattacharjee", type: ["Spouse"], gender: "Female", date: "02-22", photo: "photos/Debosmita_Bhattacharjee.jpg", spouseName: "Kamanasish Bhattacharjee" },
    { name: "Kamanasish & Debosmita", type: ["Anniversary"], gender: "All", date: "11-19", photo: "photos/Kamanasish_Debosmita.jpg" },
    { name: "Debopom Debroy", type: ["Friend","Spouse"], gender: "Male", date: "04-08", photo: "photos/Debopom_Debroy.jpg", spouseName: "Dipanwita Banik", childrenNames: ["Debodhriti Debroy"] },
    { name: "Dipanwita Banik", type: ["Friend","Spouse"], gender: "Female", date: "11-06", photo: "photos/Dipanwita_Banik.jpg", spouseName: "Debopom Debroy", childrenNames: ["Debodhriti Debroy"] },
    { name: "Debopom & Dipanwita", type: ["Anniversary"], gender: "All", date: "02-01", photo: "photos/Debopom_Dipanwita.jpg" },
    { name: "Debodhriti Debroy", type: ["Child"], gender: "Female", date: "04-29", photo: "photos/Debodhriti_Debroy.jpg", parents: ["Debopom Debroy", "Dipanwita Banik"] },
    { name: "Sourav Paul", type: ["Friend","Spouse"], gender: "Male", date: "02-17", photo: "photos/Sourav_Paul.jpg", spouseName: "Sougata Paul", childrenNames: ["Anumegha Paul"] },
    { name: "Sougata Paul", type: ["Friend","Spouse"], gender: "Female", date: "03-18", photo: "photos/Sougata_Paul.jpg", spouseName: "Sourav Paul", childrenNames: ["Anumegha Paul"] },
    { name: "Sourav & Sougata", type: ["Anniversary"], gender: "All", date: "02-01", photo: "photos/Sourav_Sougata.jpg" },
    { name: "Anumegha Paul", type: ["Child"], gender: "Female", date: "03-06", photo: "photos/Anumegha_Paul.jpg", parents: ["Sourav Paul", "Sougata Paul"] },
    { name: "Ashim Debnath", type: ["Friend"], gender: "Male", date: "01-23", photo: "photos/Ashim_Debnath.jpg", spouseName: "Swarupa Nath", childrenNames: ["Ahili Debnath"] },
    { name: "Swarupa Nath", type: ["Spouse"], gender: "Female", date: "03-18", photo: "photos/Swarupa_Nath.jpg", spouseName: "Ashim Debnath", childrenNames: ["Ahili Debnath"] },
    { name: "Ashim & Swarupa", type: ["Anniversary"], gender: "All", date: "11-21", photo: "photos/Ashim_Swarupa.jpg" },
    { name: "Ahili Debnath", type: ["Child"], gender: "Female", date: "01-09", photo: "photos/Ahili_Debnath.jpg", parents: ["Ashim Debnath", "Swarupa Nath"] },
    { name: "Sayan Gupta", type: ["Friend"], gender: "Male", date: "08-31", photo: "photos/Sayan_Gupta.jpg", spouseName: "Arunima Roy", childrenNames: ["Enakshi Gupta"] },
    { name: "Arunima Roy", type: ["Spouse"], gender: "Female", date: "01-09", photo: "photos/Arunima_Roy.jpg", spouseName: "Sayan Gupta", childrenNames: ["Enakshi Gupta"] },
    { name: "Sayan & Arunima", type: ["Anniversary"], gender: "All", date: "11-24", photo: "photos/Sayan_Arunima.jpg" },
    { name: "Enakshi Gupta", type: ["Child"], gender: "Female", date: "08-11", photo: "photos/Enakshi_Gupta.jpg", parents: ["Sayan Gupta", "Arunima Roy"] },
    { name: "Amaresh Nath", type: ["Friend"], gender: "Male", date: "10-05", photo: "photos/Amaresh_Nath.jpg", spouseName: "Baishakhi Debnath", childrenNames: ["Ashvik Nath"] },
    { name: "Baishakhi Debnath", type: ["Spouse"], gender: "Female", date: "04-25", spouseName: "Amaresh Nath", childrenNames: ["Ashvik Nath"] },
    { name: "Amaresh & Baishakhi", type: ["Anniversary"], gender: "All", date: "12-13", photo: "photos/Amaresh_Baishakhi.jpg" },
    { name: "Ashvik Nath", type: ["Child"], gender: "Male", date: "12-20", parents: ["Amaresh Nath", "Baishakhi Debnath"] }
];

/* normalize */
people.forEach(p => {
    if (!Array.isArray(p.type)) p.type = p.type ? [p.type] : [];
    if (!p.gender) p.gender = 'All';
    if (!p.childrenNames) p.childrenNames = [];
    if (!p.parents) p.parents = [];
});

/* state */
let currentSort = 'date';    // <-- default sort by date now
let currentSearch = '';
let expandedMap = {}; // name -> true/false

/* utilities */
function fallbackAvatar(name){
    const initials = (name||'').split(' ').map(s=>s[0]||'').join('').slice(0,2).toUpperCase();
    return 'https://via.placeholder.com/150?text=' + encodeURIComponent(initials);
}
function findPerson(name){ return people.find(p => p.name === name) || null; }
function escapeId(s){ return (s||'').replace(/[^a-z0-9\-_]/gi, '-'); }
function escapeJs(s){ return (s||'').replace(/'/g, "\\'").replace(/"/g, '\\"'); }

function getDaysUntil(dateString){
    if (!dateString || !/^\d{2}-\d{2}$/.test(dateString)) return Infinity;
    const [mm, dd] = dateString.split('-').map(Number);
    const today = new Date();
    const todayMid = new Date(today.getFullYear(), today.getMonth(), today.getDate());
    let next = new Date(today.getFullYear(), mm-1, dd);
    if (next < todayMid) next.setFullYear(todayMid.getFullYear() + 1);
    const diff = Math.ceil((next - todayMid) / (24*60*60*1000));
    return diff;
}
function formatDate(mmdd){
    if(!mmdd) return 'â€”';
    const [m,d] = mmdd.split('-').map(Number);
    const dt = new Date(2000, m-1, d);
    return dt.toLocaleDateString('en-US', { month:'long', day: 'numeric' });
}

/* ============================================
   Rendering: person card + expandable tree area
   ============================================ */

function personToHTML(person){
    const parts = (person.date || '').split('-');
    let dateStr = 'Date not set';
    if(parts.length === 2){
        dateStr = formatDate(person.date);
    }
    const days = getDaysUntil(person.date);
    const isToday = days === 0;
    const countdownText = isToday ? 'ðŸŽ‰ TODAY! ðŸŽ‰' : (days === Infinity ? 'Date not set' : `${days} day${days===1?'':'s'} to go`);

    // tags
    const tagsHtml = (person.type || []).map(t => `<span class="tag ${t}">${t}</span>`).join('');

    // spouse (display if spouseName present)
    let spouseHtml = '';
    if(person.spouseName){
        spouseHtml = `<div class="spouse-line">Spouse: <button class="spouse-link" onclick="expandAndScroll('${escapeJs(person.spouseName)}')">${person.spouseName}</button></div>`;
    }

    // child - show parents (if this person is child)
    let parentsBlock = '';
    if(person.type.includes('Child')){
        const parents = (person.parents && person.parents.length) ? person.parents : [];
        if(parents.length){
            parentsBlock = `<div class="parents-block"><strong>Parents:</strong> ${parents.map(p => `<button class="parent-link" onclick="expandAndScroll('${escapeJs(p)}')">${p}</button>`).join('')}</div>`;
        }
    }

    // expanded tree area (only show when expanded)
    const isExpanded = !!expandedMap[person.name];
    const treeContent = isExpanded ? renderTreeForPerson(person) : '';
    const treeMax = isExpanded ? '1000px' : '0px';

    const genderClass = (person.gender === 'Male' || person.gender === 'Female') ? person.gender : '';

    return `
        <div class="card ${genderClass}" id="card-${escapeId(person.name)}" data-name="${person.name}">
            <img class="avatar" src="${person.photo || fallbackAvatar(person.name)}" alt="${person.name}" onerror="this.onerror=null;this.src='${fallbackAvatar(person.name)}'">
            <div class="name">${person.name}</div>
            ${tagsHtml}
            <div class="meta">${dateStr} â€¢ <span style="color:var(--text-light)">${countdownText}</span></div>
            ${spouseHtml}
            ${parentsBlock}
            <div style="margin-top:10px">
                <button class="btn" onclick="toggleExpand('${escapeJs(person.name)}')">${isExpanded ? 'Collapse' : 'Expand'}</button>
            </div>

            <div class="tree-wrap" id="tree-${escapeId(person.name)}" style="max-height:${treeMax};">
                ${treeContent}
            </div>
        </div>
    `;
}

/* render the small family tree for a person */
function renderTreeForPerson(person){
    // Friend/Person node
    const mainNode = `
        <div class="tree" role="group" aria-label="${person.name} family tree">
            <div class="node" aria-label="Person">
                <img class="n-avatar" src="${person.photo || fallbackAvatar(person.name)}" alt="${person.name}" onerror="this.onerror=null;this.src='${fallbackAvatar(person.name)}'">
                <div>
                    <div class="n-title">${person.name} <span style="font-size:0.85rem;color:var(--text-light)">${(person.type||[]).join(', ')}</span></div>
                    <div class="n-sub">Birthday: ${formatDate(person.date)} ${getDaysUntil(person.date)===0? 'â€¢ Today' : ''}</div>
                </div>
            </div>
    `;

    // Spouse node (if spouseName known)
    let spouseBlock = '';
    if(person.spouseName){
        const spouse = findPerson(person.spouseName);
        if(spouse){
            spouseBlock = `
                <div style="margin-top:8px">
                    <div class="node" aria-label="Spouse">
                        <img class="n-avatar" src="${spouse.photo || fallbackAvatar(spouse.name)}" alt="${spouse.name}" onerror="this.onerror=null;this.src='${fallbackAvatar(spouse.name)}'">
                        <div>
                            <div class="n-title">${spouse.name} <span style="font-size:0.85rem;color:var(--text-light)">${(spouse.type||[]).join(', ')}</span></div>
                            <div class="n-sub">Birthday: ${formatDate(spouse.date)} ${getDaysUntil(spouse.date)===0? 'â€¢ Today' : ''}</div>
                        </div>
                    </div>
                </div>
            `;
        } else {
            spouseBlock = `
                <div style="margin-top:8px">
                    <div class="node" aria-label="Spouse">
                        <div style="width:48px;height:48px;border-radius:50%;background:#f5f5f5;margin-right:12px;display:inline-block"></div>
                        <div>
                            <div class="n-title">${person.spouseName}</div>
                            <div class="n-sub">Spouse (details not available)</div>
                        </div>
                    </div>
                </div>
            `;
        }
    }

    // Children: try person.childrenNames, else find children with this person in parents list
    let children = [];
    if(Array.isArray(person.childrenNames) && person.childrenNames.length){
        children = person.childrenNames.map(n => findPerson(n) || { name:n, type:['Child'] });
    } else {
        children = people.filter(p => Array.isArray(p.parents) && p.parents.includes(person.name) && p.type.includes('Child'));
    }

    let childrenHtml = '';
    if(children.length){
        childrenHtml = `<div class="children">`;
        children.forEach(child => {
            const parents = (child.parents && child.parents.length) ? child.parents : [];
            childrenHtml += `
                <div class="node" aria-label="Child">
                    <img class="n-avatar" src="${child.photo || fallbackAvatar(child.name)}" alt="${child.name}" onerror="this.onerror=null;this.src='${fallbackAvatar(child.name)}'">
                    <div>
                        <div class="n-title">${child.name} <span style="font-size:0.85rem;color:var(--text-light)">${(child.type||[]).join(', ')}</span></div>
                        <div class="n-sub">Birthday: ${formatDate(child.date)} ${getDaysUntil(child.date)===0? 'â€¢ Today' : ''}</div>
                        ${parents.length ? `<div class="parents-block"><strong>Parents:</strong> ${parents.map(p=>` <button class="parent-link" onclick="expandAndScroll('${escapeJs(p)}')">${p}</button>`).join('')}</div>` : ''}
                    </div>
                </div>
            `;
        });
        childrenHtml += `</div>`;
    }

    return mainNode + spouseBlock + childrenHtml + `</div>`;
}

/* render all cards based on filters/search */
function renderCards(){
    const grid = document.getElementById('cardGrid');
    const genderFilter = document.getElementById('genderFilter').value;
    const categoryFilter = document.getElementById('categoryFilter').value;

    let filtered = people.filter(person => {
        const gMatch = genderFilter === 'All' || person.gender === 'All' || person.gender === genderFilter || person.type.includes('Anniversary');
        const cMatch = categoryFilter === 'All' || person.type.includes(categoryFilter);
        const sMatch = !currentSearch || person.name.toLowerCase().includes(currentSearch.toLowerCase());
        return gMatch && cMatch && sMatch;
    });

    if(currentSort === 'alpha'){
        filtered.sort((a,b) => a.name.localeCompare(b.name));
    } else {
        filtered.sort((a,b) => getDaysUntil(a.date) - getDaysUntil(b.date));
    }

    grid.innerHTML = filtered.length ? filtered.map(personToHTML).join('') : `<div style="grid-column:1/-1;text-align:center;color:var(--text-light)">No entries</div>`;

    // After render, ensure opened trees animate correctly
    setTimeout(()=> {
        Object.keys(expandedMap).forEach(name => {
            const el = document.getElementById('tree-' + escapeId(name));
            if(el){
                el.style.maxHeight = expandedMap[name] ? (el.scrollHeight + 30) + 'px' : '0px';
            }
        });
    }, 60);

    // update upcoming event section
    updateUpcoming();
}

/* toggle expand for name */
function toggleExpand(name){
    // If the clicked card is already expanded, collapse it.
    if (expandedMap[name]) {
        expandedMap[name] = false;
    } else {
        // Collapse all others, then expand this one
        Object.keys(expandedMap).forEach(k => expandedMap[k] = false);
        expandedMap[name] = true;
    }

    renderCards();

    // scroll into view for the newly-expanded card
    setTimeout(()=> {
        const el = document.getElementById('card-' + escapeId(name));
        if(el){ el.scrollIntoView({behavior:'smooth', block:'center'}); }
    }, 120);
}

/* expand target name and scroll (used by spouse and parent links) */
function expandAndScroll(name){
    Object.keys(expandedMap).forEach(k => expandedMap[k] = false);
    expandedMap[name] = true;
    renderCards();
    setTimeout(()=> {
        const el = document.getElementById('card-' + escapeId(name));
        const tree = document.getElementById('tree-' + escapeId(name));
        if(tree){
            tree.style.maxHeight = (tree.scrollHeight + 30) + 'px';
        }
        if(el){
            el.scrollIntoView({behavior:'smooth', block:'center'});
            el.style.transition = 'box-shadow .3s';
            el.style.boxShadow = '0 0 0 4px rgba(108,99,255,0.08)';
            setTimeout(()=> el.style.boxShadow = '', 1400);
        }
    }, 140);
}

/* search and sort functions */
function handleSearch(){ currentSearch = document.getElementById('searchInput').value || ''; renderCards(); }
function setSort(type){ currentSort = type; document.getElementById('btnAlpha').classList.toggle('active-sort', type==='alpha'); document.getElementById('btnDate').classList.toggle('active-sort', type==='date'); renderCards(); }

/* =========================
   Upcoming event logic + confetti
   ========================= */

function getNextEvent() {
    // consider both birthday-like dates (for people) and Anniversary entries in people array
    let best = null;
    people.forEach(p => {
        if (!p.date) return;
        const days = getDaysUntil(p.date);
        if (days === Infinity) return;
        if (best === null || days < best.days) {
            best = { person: p, days };
        }
    });
    return best; // { person, days } or null
}

function updateUpcoming() {
    const container = document.getElementById('upcomingSection');
    const msgEl = document.getElementById('upcomingMsg');
    const dateEl = document.getElementById('upcomingDate');
    const confettiEl = document.getElementById('confetti');

    const next = getNextEvent();
    if (!next) {
        container.style.display = 'none';
        confettiEl.innerHTML = '';
        return;
    }

    const p = next.person;
    const dateStr = formatDate(p.date);
    // show "Wish X on Y Date" â€” for anniversaries, the name may be combined (like "A & B")
    msgEl.textContent = `Wish ${p.name} on ${dateStr}`;
    dateEl.textContent = (next.days === 0) ? 'Today' : `${next.days} day${next.days===1?'':'s'} left`;

    container.style.display = 'flex';
    // create confetti once per update (clears previous)
    createConfetti(confettiEl);
}

function createConfetti(container) {
    container.innerHTML = '';
    const colors = ['#FF4D4F','#FFB64D','#FFD84D','#6C63FF','#4DD0E1','#D1FF86'];
    const count = 14;
    for (let i=0; i<count; i++){
        const s = document.createElement('span');
        const left = Math.round((i / (count - 1)) * 100); // 0..100%
        const size = 6 + Math.round(Math.random() * 8);
        s.style.left = left + '%';
        s.style.width = size + 'px';
        s.style.height = size + 'px';
        s.style.background = colors[Math.floor(Math.random() * colors.length)];
        // randomize animation duration & delay
        const dur = 1400 + Math.round(Math.random() * 800); // longer duration for smooth loop
        const delay = Math.round(Math.random() * 1400);     // stagger start times across duration
        s.style.animationDuration = dur + 'ms';
        s.style.animationDelay = delay + 'ms';
        container.appendChild(s);
    }
}

/* initial render */
document.addEventListener('DOMContentLoaded', () => {
    // set initial active sort button state (date as default)
    document.getElementById('btnAlpha').classList.toggle('active-sort', currentSort === 'alpha');
    document.getElementById('btnDate').classList.toggle('active-sort', currentSort === 'date');

    renderCards();
});

// expose for debugging
window._CIRCLE = { people, renderCards, expandAndScroll, toggleExpand, updateUpcoming };
</script>

</body>
</html>
