<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Prayash Calendar — Friends (Expandable)</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#F0F2F5; --card:#fff; --accent:#6C63FF; --muted:#8a9296;
    --male:#e8f3ff; --female:#fff0f6;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:'Outfit',system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
    background:var(--bg); color:#222; padding:28px;
  }
  header{ text-align:center; margin-bottom:22px}
  h1{font-size:1.9rem; margin:0; font-weight:600}
  p.lead{margin:6px 0 0;color:var(--muted)}

  .controls{display:flex;gap:12px;justify-content:center;margin:18px 0 26px;flex-wrap:wrap}
  .search{padding:10px 14px;border-radius:999px;border:1px solid #ddd;background:white;min-width:220px}
  .btn{padding:10px 14px;border-radius:999px;border:1px solid #ddd;background:white;cursor:pointer}
  .btn.active{background:var(--accent);color:#fff;border-color:var(--accent)}

  /* Grid */
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:20px;max-width:1200px;margin:0 auto}

  /* Friend card */
  .card{
    background:var(--card); border-radius:16px; padding:18px; box-shadow:0 10px 28px rgba(18,20,26,0.06);
    position:relative; overflow:visible; transition:transform .18s ease;
  }
  .card:hover{ transform:translateY(-6px) }
  .avatar{width:84px;height:84px;border-radius:50%;object-fit:cover;border:3px solid var(--card);box-shadow:0 6px 18px rgba(0,0,0,0.08); display:block;margin:0 auto}
  .name{margin-top:12px;text-align:center;font-weight:600}
  .meta{ text-align:center;color:var(--muted); font-size:0.92rem;margin-top:6px }

  /* expand toggle */
  .expand-toggle{ display:flex; justify-content:center;margin-top:12px }
  .toggle-btn{ background:transparent;border:1px solid #eee;padding:8px 12px;border-radius:999px;cursor:pointer }
  .toggle-btn:focus{outline:2px solid rgba(108,99,255,0.18)}

  /* Tree container (hidden by default) */
  .tree-wrap{ max-height:0; overflow:hidden; transition:max-height .36s cubic-bezier(.2,.9,.3,1); margin-top:12px }
  .tree{ margin-top:8px; padding-left:16px; position:relative }

  /* vertical line */
  .tree::before{ content:""; position:absolute; left:10px; top:0; bottom:0; width:2px; background:linear-gradient(#eee,#eee); border-radius:2px; }

  /* node */
  .node{
    background: #fff; border-radius:12px; padding:10px 12px; display:flex; gap:12px; align-items:center;
    box-shadow:0 8px 20px rgba(10,10,10,0.04); margin-bottom:12px; position:relative;
  }
  .node:before{ content:""; position:absolute; left:-18px; top:16px; width:18px; height:2px; background:#eee }
  .node .n-avatar{ width:48px;height:48px;border-radius:50%;object-fit:cover }
  .node .n-body{ font-size:0.95rem }
  .node .n-title{ font-weight:600 }
  .node .n-sub{ color:var(--muted); font-size:0.85rem; margin-top:3px }

  /* child branch indentation */
  .children{ padding-left:26px; margin-top:-6px }

  /* parents block for child */
  .parents-block{ margin-top:8px; font-size:0.85rem; color:var(--muted); background:linear-gradient(90deg,#fafafa,#fff); padding:8px;border-radius:8px; border:1px solid #f0f0f0 }

  /* small badges */
  .badge{ font-size:0.75rem; padding:4px 8px; border-radius:999px; background:#f3f3ff; color:var(--accent); display:inline-block; margin-left:8px }

  /* responsive */
  @media (max-width:560px){
    .node .n-avatar{width:40px;height:40px}
    .avatar{width:72px;height:72px}
  }
</style>
</head>
<body>

<header>
  <h1>Prayash Calendar</h1>
  <p class="lead">Friends list — click a friend to expand spouse & children (tree view)</p>
</header>

<div class="controls" aria-hidden="false">
  <input id="searchInput" class="search" placeholder="Search friends..." oninput="onSearch()" aria-label="Search friends">
  <button class="btn" id="clearBtn" onclick="clearSearch()">Clear</button>
</div>

<main>
  <div class="grid" id="friendsGrid" aria-live="polite"></div>
</main>

<script>
/* ---------------------
   Data (relationships)
   --------------------- */
const people = [
  // Friends (primary shown on first page)
  { name: "Kamanasish Bhattacharjee", type:["Friend"], gender:"Male", date:"11-08", photo:"photos/Kamanasish_Bhattacharjee.jpeg", spouseName: "Debosmita Bhattacharjee" },

  // Debopom and Dipanwita are both friends AND spouses of each other; their child is Debodhriti
  { name: "Debopom Debroy", type:["Friend"], gender:"Male", date:"04-08", photo:"photos/Debopom_Debroy.jpg", spouseName:"Dipanwita Banik", childrenNames:["Debodhriti Debroy"] },
  { name: "Dipanwita Banik", type:["Friend"], gender:"Female", date:"11-06", photo:"photos/Dipanwita_Banik.jpg", spouseName:"Debopom Debroy", childrenNames:["Debodhriti Debroy"] },

  // Debosmita is spouse of Kamanasish but NOT a friend entry (so she shouldn't be on the first page)
  { name: "Debosmita Bhattacharjee", type:["Spouse"], gender:"Female", date:"02-22", photo:"photos/Debosmita_Bhattacharjee.jpg" },

  // Child record — will appear under parents when parents expand
  { name: "Debodhriti Debroy", type:["Child"], gender:"Female", date:"04-29", photo:"photos/Debodhriti_Debroy.jpg", parents:["Debopom Debroy","Dipanwita Banik"] }
];

/* normalize safety */
people.forEach(p=>{
  if (!Array.isArray(p.type)) p.type = p.type ? [p.type] : [];
  if (!p.gender) p.gender = 'All';
  if (!p.childrenNames) p.childrenNames = [];
  if (!p.parents) p.parents = [];
});

/* helper: find person by name */
function findPerson(name){
  return people.find(p => p.name === name) || null;
}

/* fallback avatar */
function avatarFor(name){
  const initials = (name||'').split(' ').map(n=>n[0]||'').join('').slice(0,2).toUpperCase();
  return 'https://via.placeholder.com/150?text=' + encodeURIComponent(initials);
}

/* small util: days until (MM-DD) */
function getDaysUntil(mmdd){
  if(!mmdd || !/^\d{2}-\d{2}$/.test(mmdd)) return Infinity;
  const [mm,dd] = mmdd.split('-').map(Number);
  const today = new Date(); const todayMid = new Date(today.getFullYear(),today.getMonth(),today.getDate());
  let next = new Date(today.getFullYear(), mm-1, dd);
  if(next < todayMid) next.setFullYear(today.getFullYear()+1);
  const diff = Math.ceil((next - todayMid) / (24*60*60*1000));
  return diff;
}

/* ---------------------
   Rendering (Friends Only)
   --------------------- */

let expandedMap = {}; // track which friend is expanded
let searchTerm = '';

function renderFriends(){
  const grid = document.getElementById('friendsGrid');

  // show only friends on first page (type includes Friend)
  let friends = people.filter(p => p.type.includes('Friend'));

  // apply search filter
  if(searchTerm.trim()){
    const q = searchTerm.toLowerCase();
    friends = friends.filter(f => f.name.toLowerCase().includes(q));
  }

  // sort alphabetically
  friends.sort((a,b)=> a.name.localeCompare(b.name));

  // build HTML
  const html = friends.map(friend => {
    const days = getDaysUntil(friend.date);
    const todayBadge = days === 0 ? '<span class="badge">Today</span>' : '';
    const daysText = (days === Infinity) ? '' : `<div class="meta">${days === 0 ? 'Today' : days + ' day' + (days===1?'':'s') + ' to go'}</div>`;

    // expanded tree (rendered if expandedMap[friend.name] true)
    const isExpanded = !!expandedMap[friend.name];
    const treeInner = isExpanded ? renderTreeForFriend(friend) : '';

    // set max-height later via inline style to animate
    const treeMax = isExpanded ? '1000px' : '0px';

    return `
      <article class="card" role="article" aria-expanded="${isExpanded}">
        <img class="avatar" src="${friend.photo || avatarFor(friend.name)}" alt="${friend.name}" onerror="this.onerror=null;this.src='${avatarFor(friend.name)}'">
        <div class="name">${friend.name}</div>
        <div class="meta">${friend.type.join(', ')} ${todayBadge}</div>
        ${daysText}
        <div class="expand-toggle">
          <button class="toggle-btn" aria-controls="tree-${escapeId(friend.name)}" onclick="toggleExpand('${escapeJs(friend.name)}')">
            ${isExpanded ? 'Collapse' : 'View family'}
          </button>
        </div>

        <div id="tree-${escapeId(friend.name)}" class="tree-wrap" style="max-height:${treeMax}">
          ${treeInner}
        </div>
      </article>
    `;
  }).join('');

  grid.innerHTML = html || `<div style="grid-column:1/-1;text-align:center;color:var(--muted)">No friends found</div>`;
}

/* escape helpers for safe IDs and inline JS */
function escapeId(s){ return (s||'').replace(/[^a-z0-9\-_]/gi,'-') }
function escapeJs(s){ return (s||'').replace(/'/g,"\\'").replace(/"/g,'\\"') }

/* render the tree HTML for a friend */
function renderTreeForFriend(friend){
  // main node (friend)
  const friendNode = `
    <div class="tree">
      <div class="node" aria-label="Friend">
        <img class="n-avatar" src="${friend.photo || avatarFor(friend.name)}" alt="${friend.name}" onerror="this.onerror=null;this.src='${avatarFor(friend.name)}'">
        <div class="n-body">
          <div class="n-title">${friend.name} <span style="font-size:0.8rem;color:var(--muted);">(${friend.type.join(', ')})</span></div>
          <div class="n-sub">Birthday: ${formatDate(friend.date)} ${birthDays(friend.date)}</div>
        </div>
      </div>
  `;

  // spouse node: find spouse by friend.spouseName if present
  let spouseHtml = '';
  if(friend.spouseName){
    const spousePerson = findPerson(friend.spouseName);
    if(spousePerson){
      spouseHtml = `
        <div class="node" aria-label="Spouse">
          <img class="n-avatar" src="${spousePerson.photo || avatarFor(spousePerson.name)}" alt="${spousePerson.name}" onerror="this.onerror=null;this.src='${avatarFor(spousePerson.name)}'">
          <div class="n-body">
            <div class="n-title">${spousePerson.name} <span style="font-size:0.8rem;color:var(--muted);">(${spousePerson.type.join(', ')})</span></div>
            <div class="n-sub">Birthday: ${formatDate(spousePerson.date)} ${birthDays(spousePerson.date)}</div>
          </div>
        </div>
      `;
    } else {
      spouseHtml = `
        <div class="node" aria-label="Spouse">
          <div style="width:48px;height:48px;border-radius:50%;background:#f5f5f5;display:inline-block;margin-right:12px"></div>
          <div class="n-body">
            <div class="n-title">${friend.spouseName}</div>
            <div class="n-sub">(spouse - details not in list)</div>
          </div>
        </div>
      `;
    }
  }

  // children nodes: either from friend.childrenNames or by scanning people where parents include friend
  let childrenList = [];
  // prefer explicit childrenNames if present
  if(Array.isArray(friend.childrenNames) && friend.childrenNames.length){
    childrenList = friend.childrenNames.map(n => findPerson(n) || { name:n, type:['Child'] });
  } else {
    // fallback: find people who listed this friend as parent
    childrenList = people.filter(p => Array.isArray(p.parents) && p.parents.includes(friend.name) && p.type.includes('Child'));
  }

  let childrenHtml = '';
  if(childrenList.length){
    childrenHtml = `<div class="children">`;
    childrenList.forEach(child=>{
      const parents = (child.parents && child.parents.length) ? child.parents : (child.name === 'Debodhriti Debroy' ? ['Debopom Debroy','Dipanwita Banik'] : []);
      childrenHtml += `
        <div class="node" aria-label="Child">
          <img class="n-avatar" src="${child.photo || avatarFor(child.name)}" alt="${child.name}" onerror="this.onerror=null;this.src='${avatarFor(child.name)}'">
          <div class="n-body">
            <div class="n-title">${child.name} <span style="font-size:0.8rem;color:var(--muted);">(${child.type.join(',')})</span></div>
            <div class="n-sub">Birthday: ${formatDate(child.date)} ${birthDays(child.date)}</div>
            <div class="parents-block"><strong>Parents:</strong> ${parents.map(p=>`<span style="margin-left:8px">${p}</span>`).join('')}</div>
          </div>
        </div>
      `;
    });
    childrenHtml += `</div>`;
  }

  const combined = friendNode + (spouseHtml ? `<div style="margin-top:8px">${spouseHtml}</div>` : '') + (childrenHtml ? childrenHtml : '') + `</div>`;
  return combined;
}

/* small helpers for displaying date text & badge */
function formatDate(mmdd){
  if(!mmdd) return '—';
  const [mm,dd] = mmdd.split('-').map(Number);
  try{
    const d = new Date(2000, mm-1, dd);
    return d.toLocaleDateString('en-US',{ month:'short', day:'numeric' });
  }catch(e){ return mmdd; }
}
function birthDays(mmdd){
  const days = getDaysUntil(mmdd);
  if(days === Infinity) return '';
  if(days === 0) return '• Today';
  return `• ${days}d`;
}

/* toggle expand/collapse */
function toggleExpand(friendName){
  expandedMap[friendName] = !expandedMap[friendName];
  renderFriends();

  // animate max-height of opened tree after render
  setTimeout(()=> {
    const id = 'tree-' + escapeId(friendName);
    const el = document.getElementById(id);
    if(el){
      if(expandedMap[friendName]){
        el.style.maxHeight = el.scrollHeight + 30 + 'px';
      } else {
        el.style.maxHeight = '0px';
      }
    }
  }, 60);
}

/* search input handler */
function onSearch(){
  const v = document.getElementById('searchInput').value || '';
  searchTerm = v;
  renderFriends();
}

function clearSearch(){
  document.getElementById('searchInput').value = '';
  searchTerm = '';
  renderFriends();
}

/* initial render on load */
renderFriends();

/* utility escapes (same as above) */
function escapeId(s){ return (s||'').replace(/[^a-z0-9\-_]/gi,'-') }
function escapeJs(s){ return (s||'').replace(/'/g,"\\'").replace(/"/g,'\\"') }

/* expose to console for debugging */
window._PRAY = { people, renderFriends, toggleExpand };
</script>
</body>
</html>
